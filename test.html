<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test AI Workout Generator</title>
    <style>
        input, select, button {
            margin: 10px 0;
            padding: 10px;
            font-size: 16px;
        }

        input, select {
            width: 300px;
        }

        button {
            background-color: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
        }

        button:hover {
            background-color: #45a049;
        }

        #result {
            margin-top: 20px;
            padding: 15px;
            border: 1px solid #ccc;
            font-family: Arial, sans-serif;
            white-space: pre-wrap;
        }

        .auth-section {
            margin-top: 30px;
        }

        .hidden {
            display: none;
        }

        #workout-generator {
            display: none;
        }
    </style>
</head>
<body>
    <h1>Test AI Workout Generator</h1>
    
    <div class="auth-section" id="register-section">
        <h2>Register</h2>
        <label for="reg-email">Email:</label>
        <input type="email" id="reg-email" placeholder="Enter email" />

        <label for="reg-password">Password:</label>
        <input type="password" id="reg-password" placeholder="Enter password" />

        <button id="register">Register</button>
    </div>

    <div class="auth-section" id="login-section">
        <h2>Login</h2>
        <label for="login-email">Email:</label>
        <input type="email" id="login-email" placeholder="Enter email" />

        <label for="login-password">Password:</label>
        <input type="password" id="login-password" placeholder="Enter password" />

        <button id="login">Login</button>
    </div>

    <div id="workout-generator" class="auth-section">
        <label for="injury">Injury:</label>
        <input type="text" id="injury" placeholder="e.g., knee, shoulder, back" />

        <label for="severity">Severity:</label>
        <input type="text" id="severity" placeholder="e.g., moderate, severe, mild" />

        <label for="timeline">Timeline:</label>
        <select id="timeline">
            <option value="quick">Quick</option>
            <option value="moderate">Moderate</option>
            <option value="slow">Slow</option>
        </select>

        <button id="generate-workout">Generate Workout</button>
        <button id="save-workout" style="display:none;">Save Workout Plan</button>

        <div id="result"></div>
    </div>

    <script>
        let generatedPlan = null;
        let userToken = null;

        //register the user
        document.getElementById('register').addEventListener('click', function () {
            const email = document.getElementById('reg-email').value.trim();
            const password = document.getElementById('reg-password').value.trim();

            if (!email || !password) {
                alert("Please fill in both email and password.");
                return;
            }

            fetch('http://localhost:5500/register', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ email, password })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert("Registration successful!");
                } else {
                    alert("Registration failed: " + data.error);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert("Error registering user.");
            });
        });

        // login the user and store the token
        document.getElementById('login').addEventListener('click', function () {
            const email = document.getElementById('login-email').value.trim();
            const password = document.getElementById('login-password').value.trim();

            if (!email || !password) {
                alert("Please fill in both email and password.");
                return;
            }

            fetch('http://localhost:5500/login', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ email, password })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    userToken = data.token; 
                    localStorage.setItem('jwt_token', userToken); 
                    alert("Login successful!");
                    document.getElementById('login-section').classList.add('hidden');
                    document.getElementById('register-section').classList.add('hidden');
                    document.getElementById('workout-generator').style.display = 'block';
                } else {
                    alert("Login failed: " + data.error);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert("Error logging in.");
            });
        });

        // Generate workout plan
        document.getElementById('generate-workout').addEventListener('click', function () {
            const injury = document.getElementById('injury').value.trim();
            const severity = document.getElementById('severity').value.trim();
            const timeline = document.getElementById('timeline').value;

            if (!injury || !severity) {
                alert("Please fill in both injury and severity fields.");
                return;
            }

            fetch('http://localhost:5500/generate-workout', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    injury: injury,
                    severity: severity,
                    timeline: timeline,
                    token: userToken
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    generatedPlan = data.plan;
                    document.getElementById('result').innerHTML = data.plan.replace(/\n/g, '<br/>').replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
                    document.getElementById('save-workout').style.display = 'inline-block'; 
                } else {
                    document.getElementById('result').innerHTML = 'Error: ' + data.error;
                }
            })
            .catch(error => {
                console.error('Error:', error);
                document.getElementById('result').innerHTML = 'Error generating workout plan.';
            });
        });

        document.getElementById('save-workout').addEventListener('click', function () {
            if (!userToken) {
                alert("You must be logged in to save the workout plan.");
                return;
            }

            if (!generatedPlan) {
                alert("No workout plan generated to save.");
                return;
            }

            fetch('http://localhost:5500/save-workout', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    injury: document.getElementById('injury').value.trim(),
                    severity: document.getElementById('severity').value.trim(),
                    plan: generatedPlan,
                    token: userToken
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert("Workout plan saved successfully!");
                } else {
                    alert("Failed to save the workout plan.");
                }
            })
            .catch(error => {
                console.error('Error saving workout plan:', error);
                alert("Error saving workout plan.");
            });
        });
    </script>
</body>
</html>
